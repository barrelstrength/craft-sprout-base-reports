{% extends "sprout-base-reports/_layouts/elementindex" %}
{% set elementType = 'barrelstrength\\sproutbasereports\\elements\\Report' %}

{% set title  = "Reports"|t('sprout-base-reports') %}

{% if currentPluginHandle == 'sprout-reports' %}
    {% set selectedTab = 'reports' %}
{% endif %}

{% block actionButton %}

    {#@todo - where do we add a report edit permission to Sprout Integrations?#}
    {#Can we have each integration define a permission with the same name?#}
    {% if currentUser.can('sproutReports-editReports') %}

        {% if newReportOptions|length > 1 %}
            <div class="btngroup submit first">
                <a class="btn submit add icon"
                   href="{{ newReportOptions[0].url }}">{{ "New Report"|t('sprout-base-reports') }}</a>
                {% if dataSources %}
                    <div class="btn submit menubtn"></div>
                    <div class="menu">
                        <ul>
                            {% for option in newReportOptions %}
                                <li><a class="formsubmit"
                                       href="{{ option.url }}">{{ option.name }}</a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>
        {% else %}
            <div class="btngroup submit first">
                {% if newReportOptions[0] is defined %}
                    <a class="btn submit add icon" href="{{ newReportOptions[0].url }}">{{ "New Report"|t('sprout-base-reports') }}</a>
                {% endif %}
            </div>
        {% endif %}

    {% endif %}

{% endblock %}

{% block initJs %}
    // Pass segment to the NotificationEmailQuery class to filter notification entries
    var pluginHandle = {'pluginHandle': '{{ craft.app.request.getSegment(1) }}'};
    var criteria = Craft.defaultIndexCriteria

    var hideSidebar = false;
    if (pluginHandle.pluginHandle != 'sprout-reports') {
    hideSidebar = true;
    criteria = Object.assign(Craft.defaultIndexCriteria, pluginHandle);
    }

    Craft.elementIndex = Craft.createElementIndex('{{ elementType|e("js") }}', $('#main'), {
    context:        '{{ context }}',
    storageKey:     'elementindex.{{ elementType }}',
    criteria:       criteria,
    hideSidebar:    hideSidebar
    });
{% endblock %}
